name: macOS VNC Access

on: [workflow_dispatch]

jobs:
  enable-vnc:
    runs-on: macos-latest
    steps:
      - name: Show macOS version
        run: sw_vers

      - name: Enable Apple Screen Sharing VNC server
        run: |
          # Enable Remote Management (ARDAgent)
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
            -activate -configure -access -on -clientopts -setvnclegacy -vnclegacy yes \
            -clientopts -setvncpw -vncpw "mypassword" \
            -restart -agent -privs -all

      - name: Display connection info
        run: |
          IP=$(ipconfig getifaddr en0 || ipconfig getifaddr en1 || echo "Unknown")
          echo "VNC server enabled (macOS built-in)."
          echo "Connect using:"
          echo "vnc://$IP"
          echo "Password: mypassword"
